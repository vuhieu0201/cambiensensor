import serial
import time
import matplotlib.pyplot as plt  # ThÃªm thÆ° viá»‡n váº½

# âš ï¸ THAY Ä‘Ãºng COM cá»§a ESP8266 (VD: 'COM4', 'COM7', ...)
esp = serial.Serial(port='COM17', baudrate=9600, timeout=1)
time.sleep(2)

max_measurements = 50
measurements = 0
prev_time = time.perf_counter()
results = []

print("ğŸ” Báº¯t Ä‘áº§u Ä‘o tá»« ESP8266...\n")

while measurements < max_measurements:
    try:
        line = esp.readline().decode('utf-8').strip()
    except UnicodeDecodeError:
        continue

    if line:
        try:
            distance = float(line)
            current_time = time.perf_counter()
            response_time = current_time - prev_time
            prev_time = current_time

            measurements += 1
            results.append((measurements, distance, response_time))

            print(f"ğŸ”¹ Lan do {measurements}: {distance:.2f} cm | thoi gian phan hoi {response_time:.3f} giÃ¢y")

        except ValueError:
            continue

    time.sleep(0.01)

